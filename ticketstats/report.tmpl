<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{{ .Component }} - Jira Ticket Stats</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
</head>
<body>
    <section class="section">
        <h1 class="title">{{ .Component }}</h1>
        <h2 class="subtitle">JiraTicketStat report - {{ .Date }}</h2>
    </section>

    <!-- Start of template for old bug tickets -->
    <section class="section">
        <h1 class="title">Old bug tickets</h1>
        
        <table class="table">
            <thead>
                <tr>
                    <td>Issue</td>
                    <td>Age</td>
                    <td>Labels</td>
                    <td>Creator</td>
                </tr>
            </thead>
            <tbody>
                {{ range .OldBugs }}
                <tr>
                    <td>
                        <a href="{{ .JiraUrl }}">{{ .Key }}</a>
                        {{ .Summary }}
                    </td>
                    <td>{{ .Age }} days</td>
                    <td>
                        {{ range .Labels }}
                        <span class="tag">
                            {{ . }}
                        </span>
                        {{ end }}
                    </td>
                    <td>{{ .Creator }}</td>
                </tr>
                {{ end }}
            </tbody>
        </table>
    </section>
    <!-- End of template for old bug tickets -->

        <!-- Start of template for bug report -->
        <section class="section">
            {{with .Bugs}}
            <h1 class="title">Bug tickets</h1>
            <h1 class="subtitle">{{ .Count }} bug tickets</h1>
    
            <table class="table">
                <thead>
                    <tr>
                        <td></td>
                        <td>Created</td>
                        <td>Resolved</td>
                        <td>Diff</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            Last week
                        </td>
                        {{ with .Week }}
                        <td>{{ .Created }}</td>
                        <td>{{ .Resolved }}</td>
                        <td>{{ .Diff }}</td>
                        {{ end }}
                    </tr>
                    <tr>
                        <td>
                            Last month
                        </td>
                        {{ with .Month }}
                        <td>{{ .Created }}</td>
                        <td>{{ .Resolved }}</td>
                        <td>{{ .Diff }}</td>
                        {{ end }}
                    </tr>
                </tbody>
            </table>
            
            <table class="table">
                <thead>
                    <tr>
                        <td>Fix Version</td>
                        <td>Security</td>
                        <td>Count</td>
                        <td>Critical</td>
                    </tr>
                </thead>
                <tbody>
                    {{ range .BugStats }}
                    <tr>
                        <td>
                            {{ .Version }}
                        </td>
                        <td>{{ .Security }}</td>
                        <td>{{ .Count }}</td>
                        <td>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <td>Issue</td>
                                        <td>Status</td>
                                        <td>Created</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{ range .Critical }}
                                    <tr>
                                        <td>
                                            <a href="{{ .JiraUrl }}">{{ .Key }}</a>
                                            {{ .Summary }}
                                        </td>
                                        <td>
                                            <span class="tag is-info">{{ .Status }}</span>
                                        </td>
                                        <td>{{ .Created }} ({{ .Age }} days)</td>
                                    </tr>
                                    {{ end }}
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
            {{ end }}
        </section>
        <!-- End of template for bug report -->

            <!-- Start of template for feature report -->
    <section class="section">
        <h1 class="title">Features</h1>

        {{ range .Features }}
        <div class="block">
            <div class="card">
                <header class="card-header">
                    <p class="card-header-title">
                        <a href="{{ .JiraUrl }}">
                            {{ .Key }} {{ .Summary }}
                        </a>
                    </p>
                    <table class="table">
                        <thead>
                            <tr>
                                <td>Status</td>
                                <td>Assignee</td>
                                <td>Fix Version</td>
                                <td>Due</td>
                                <td>Labels</td>
                                <td>Estimate</td>
                                <td>Time spend</td>
                                <td>Progress</td>
                                <td>Planning</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <span class="tag is-info">{{ .Status }}</span>
                                </td>
                                <td>{{ .Assignee }}</td>
                                <td>
                                    {{ range .FixVersions }}
                                    <span class="tag is-light">{{ . }}</span>
                                    {{ end }}
                                </td>
                                <td>
                                    {{ if .HasDue }}
                                        {{ .Due }}
                                    {{ else }}
                                        <span class="tag is-warning">No Due</span>
                                    {{ end }}
                                </td>
                                <td>
                                    {{ range .Labels }}
                                    <span class="tag">
                                        {{ . }}
                                    </span>
                                    {{ end }}
                                </td>
                                <td>{{ .Estimate }}</td>
                                <td>{{ .TimeSpend }}</td>
                                <td>
                                    {{ if .HasTime }}
                                        <progress class="progress" value="{{ .Progress }}" max="100">{{ .Progress }}%</progress>
                                    {{ end }}
                                </td>
                                <td>
                                    {{ if .HasDue }}
                                    <span class="tag {{ if .AtRisk }}is-danger{{ else }}is-success{{ end }}">
                                        {{ .FTE }} FTE
                                    </span>
                                    {{ end }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </header>
                {{ if .HasChilds }}
                <div class="card-content">
                    <div class="content">
                        <h2>Sub-Features:</h2>
                        <table class="table">
                            <thead>
                                <tr>
                                    <td>Issue</td>
                                    <td>Status</td>
                                    <td>Assignee</td>
                                    <td>Part of</td>
                                    <td>Fix Version</td>
                                    <td>Due</td>
                                    <td>Labels</td>
                                    <td>Estimate</td>
                                    <td>Time spend</td>
                                    <td>Progress</td>
                                    <td>Planning</td>
                                </tr>
                            </thead>
                            <tbody>
                                {{ range .Childs }}
                                <tr>
                                    <td>
                                        <a href="{{ .JiraUrl }}">{{ .Key }}</a>
                                        {{ .Summary }}
                                    </td>
                                    <td>
                                        <span class="tag is-info">{{ .Status }}</span>
                                    </td>
                                    <td>{{ .Assignee }}</td>
                                    <td>
                                        {{ range .Parents }}
                                            <a href="{{ .Url }}">{{ .Name }}</a>
                                        {{ end }}
                                    </td>
                                    <td>
                                        {{ range .FixVersions }}
                                        <span class="tag is-light">{{ . }}</span>
                                        {{ end }}
                                    </td>
                                    <td>
                                        {{ if .HasDue }}
                                            {{ .Due }}
                                        {{ else }}
                                            <span class="tag is-warning">No Due</span>
                                        {{ end }}
                                    </td>
                                    <td>
                                        {{ range .Labels }}
                                        <span class="tag">
                                            {{ . }}
                                        </span>
                                        {{ end }}
                                    </td>
                                    <td>{{ .Estimate }}</td>
                                    <td>{{ .TimeSpend }}</td>
                                    <td>
                                        {{ if .HasTime }}
                                            <progress class="progress" value="{{ .Progress }}" max="100">{{ .Progress }}%</progress>
                                        {{ end }}
                                    </td>
                                    <td>
                                        {{ if .HasDue }}
                                        <span class="tag {{ if .AtRisk }}is-danger{{ else }}is-success{{ end }}">
                                            {{ .FTE }} FTE
                                        </span>
                                        {{ end }}
                                    </td>
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </section>
    <!-- End of template for feature report -->

    <section class="section">
        <h1 class="title">Improvements</h1>

        {{ range .Improvements }}
        <div class="block">
            <div class="card">
                <header class="card-header">
                    <p class="card-header-title">
                        <a href="{{ .JiraUrl }}">
                            {{ .Key }} {{ .Summary }}
                        </a>
                    </p>
                    <table class="table">
                        <thead>
                            <tr>
                                <td>Status</td>
                                <td>Assignee</td>
                                <td>Fix Version</td>
                                <td>Labels</td>
                                <td>Estimate</td>
                                <td>Time spend</td>
                                <td>Progress</td>
                                <td>Planning</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <span class="tag is-info">{{ .Status }}</span>
                                </td>
                                <td>{{ .Assignee }}</td>
                                <td>
                                    {{ range .FixVersions }}
                                    <span class="tag is-light">{{ . }}</span>
                                    {{ end }}
                                </td>
                                <td>
                                    {{ range .Labels }}
                                    <span class="tag">
                                        {{ . }}
                                    </span>
                                    {{ end }}
                                </td>
                                <td>{{ .Estimate }}</td>
                                <td>{{ .TimeSpend }}</td>
                                <td>
                                    {{ if .HasTime }}
                                        <progress class="progress" value="{{ .Progress }}" max="100">{{ .Progress }}%</progress>
                                    {{ end }}
                                </td>
                                <td>
                                    <span class="tag {{ if .AtRisk }}is-success{{ else }}is-danger{{ end }}">
                                        {{ .FTE }} FTE
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </header>
                {{ if .HasChilds }}
                <div class="card-content">
                    <div class="content">
                        <h2>Related tickets:</h2>
                        <table class="table">
                            <thead>
                                <tr>
                                    <td>Issue</td>
                                    <td>Status</td>
                                    <td>Assignee</td>
                                    <td>Part of</td>
                                    <td>Fix Version</td>
                                    <td>Labels</td>
                                    <td>Estimate</td>
                                    <td>Time spend</td>
                                    <td>Progress</td>
                                    <td>Planning</td>
                                </tr>
                            </thead>
                            <tbody>
                                {{ range .Childs }}
                                <tr>
                                    <td>
                                        <a href="{{ .JiraUrl }}">{{ .Key }}</a>
                                        {{ .Summary }}
                                    </td>
                                    <td>
                                        <span class="tag is-info">{{ .Status }}</span>
                                    </td>
                                    <td>{{ .Assignee }}</td>
                                    <td>
                                        {{ range .Parents }}
                                            <a href="{{ .Url }}">{{ .Name }}</a>
                                        {{ end }}
                                    </td>
                                    <td>
                                        {{ range .FixVersions }}
                                        <span class="tag is-light">{{ . }}</span>
                                        {{ end }}
                                    </td>
                                    <td>
                                        {{ range .Labels }}
                                        <span class="tag">
                                            {{ . }}
                                        </span>
                                        {{ end }}
                                    </td>
                                    <td>{{ .Estimate }}</td>
                                    <td>{{ .TimeSpend }}</td>
                                    <td>
                                        {{ if .HasTime }}
                                            <progress class="progress" value="{{ .Progress }}" max="100">{{ .Progress }}%</progress>
                                        {{ end }}
                                    </td>
                                    <td>
                                        <span class="tag {{ if .AtRisk }}is-success{{ else }}is-danger{{ end }}">
                                            {{ .FTE }} FTE
                                        </span>
                                    </td>
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </section>

    {{ with .Other }}
    <section class="section">
        <h1 class="title">Other tickets</h1>
        <h1 class="subtitle">{{ .Count }} other tickets</h1>

        <div class="block">
            <div class="card">
                <header class="card-header">
                    <p class="card-header-title">Last week</p>
                </header>
                <div class="card-content">
                    <div class="content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <td>Type</td>
                                    <td>Count</td>
                                    <td>Created</td>
                                    <td>Resolved</td>
                                    <td>Diff</td>
                                </tr>
                            </thead>
                            <tbody>
                                {{ range .Week }}
                                <tr>
                                    <td>{{ .Type }}</td>
                                    <td>{{ .Count }}</td>
                                    {{ with .Report }}
                                    <td>{{ .Created }}</td>
                                    <td>{{ .Resolved }}</td>
                                    <td>{{ .Diff }}</td>
                                    {{ end }}
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="block">
            <div class="card">
                <header class="card-header">
                    <p class="card-header-title">Last month</p>
                </header>
                <div class="card-content">
                    <div class="content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <td>Type</td>
                                    <td>Count</td>
                                    <td>Created</td>
                                    <td>Resolved</td>
                                    <td>Diff</td>
                                </tr>
                            </thead>
                            <tbody>
                                {{ range .Month }}
                                <tr>
                                    <td>{{ .Type }}</td>
                                    <td>{{ .Count }}</td>
                                    {{ with .Report }}
                                    <td>{{ .Created }}</td>
                                    <td>{{ .Resolved }}</td>
                                    <td>{{ .Diff }}</td>
                                    {{ end }}
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {{ end }}

    {{ with .Resources }}
    <section class="section">
        <h1 class="title">Resources</h1>

        <div class="block">
            <div class="columns">
                {{ range .Spend }}
                <div class="column">
                    <div class="card">
                        <header class="card-header">
                            <p class="card-header-title">{{ .TimeRange }} - {{ .FTE }} FTE ({{ .Effort }})</p>
                        </header>
                    </div>
                </div>
                {{ end }}
            </div>


            {{ range .Usage }}
            <div class="columns">
                {{ range . }}
                <div class="column">
                    <div class="card">
                        <div class="card-content">
                            <div class="content">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <td>{{ .Type }}</td>
                                            <td>Work</td>
                                            <td>FTE</td>
                                            <td>%</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{ range .Details }}
                                        <tr>
                                            <td>{{ .Type }}</td>
                                            <td>{{ .Work }}</td>
                                            <td>{{ .FTE }}</td>
                                            <td>
                                                <progress class="progress" value="{{ .Percent }}" max="100">
                                                    {{ .Percent }}%
                                                </progress>
                                            </td>
                                        </tr>
                                        {{ end }}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                {{ end }}
            </div>
            {{ end }}
        </div>

        <div class="block">
            <div class="columns">
                {{  range .Average }}
                <div class="column">
                    <div class="card">
                        <header class="card-header">
                            <p class="card-header-title">Average effort by ticket type ({{ .TimeRange }})</p>
                        </header>
                        <div class="card-content">
                            <div class="content">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <td>Type</td>
                                            <td>Median effort</td>
                                            <td>Mean effort</td>
                                            <td>Count</td>
                                            <td>FTE</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{ range .Details }}
                                        <tr>
                                            <td>{{ .Type }}</td>
                                            <td>{{ .Median }}</td>
                                            <td>{{ .Mean }}</td>
                                            <td>{{ .Count }}</td>
                                            <td>{{ .FTE }}</td>
                                        </tr>
                                        {{ end }}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
    </section>
    {{ end }}

    {{ if .HasWarnings }}
    {{ with .Warnings }}
    <section class="section">
        <h1 class="title">Warnings</h1>
        <h1 class="subtitle">{{ .Count }} tickets with invalid state</h1>

        <div class="block">
            <div class="card">
                <header class="card-header">
                    <p class="card-header-title">No activity assigned</p>
                </header>
                <div class="card-content">
                    <div class="content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <td>Issue</td>
                                </tr>
                            </thead>
                            <tbody>
                                {{ range .NoActivity }}
                                <tr>
                                    <td>
                                        <a href="{{ .JiraUrl }}">{{ .Key }}</a>
                                        {{ .Summary }}
                                    </td>
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="block">
            <div class="card">
                <header class="card-header">
                    <p class="card-header-title">Invalid time bookings</p>
                </header>
                <div class="card-content">
                    <div class="content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <td>Issue</td>
                                    <td>Activity</td>
                                    <td>Bookings</td>
                                </tr>
                            </thead>
                            <tbody>
                                {{ range .InvalidBooking }}
                                <tr>
                                    {{ with .Issue }}
                                    <td>
                                        <a href="{{ .JiraUrl }}">{{ .Key }}</a>
                                        {{ .Summary }}
                                    </td>
                                    <td>{{ .Activity }}</td>
                                    {{ end }}
                                    <td>
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <td>Activity</td>
                                                    <td>Date</td>
                                                    <td>Hours</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {{ range .Logs }}
                                                <tr>
                                                    <td>{{ .Activity }}</td>
                                                    <td>{{ .Date }}</td>
                                                    <td>{{ .Effort }}</td>
                                                </tr>
                                                {{ end }}
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {{ end }}
    {{ end }}

</body>
</html>
